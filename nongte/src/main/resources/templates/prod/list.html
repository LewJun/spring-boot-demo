<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <base href="/nongte/"/>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta content="" name="description"/>
    <meta content="" name="author"/>
    <link href="images/favicon.ico" rel="icon"/>

    <title>产品列表</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet"/>

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="css/ie10-viewport-bug-workaround.css" rel="stylesheet"/>

    <!-- Custom styles for this template -->
    <link href="css/navbar-fixed-top.css" rel="stylesheet"/>
    <!-- <link href="assets/css/non-responsive.css" rel="stylesheet" /> -->

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9
      ]>
    <script src="js/ie8-responsive-file-warning.js"></script
    ><![endif]-->
    <script src="js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="html5shiv.min.js"></script>
    <script src="respond.min.js"></script>
    <![endif]-->
    <link href="css/style.css" rel="stylesheet"/>
</head>

<body>
<!-- Fixed navbar -->
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="#">特农网</a>
        </div>
        <div class="navbar-collapse collapse" id="navbar">
            <ul class="nav navbar-nav navbar-right">
                <%
                var loginUser = session.loginUser !"";
                %>
                <li><a href="#">首页</a></li>
                <li class="active"><a href="prod/list">产品列表</a></li>
                <li><a href="about">关于我们</a></li>
                <li><a href="contact">联系我们</a></li>
                <%
                if(loginUser == "") {
                %>
                <li><a href="signin">登录</a></li>
                <%} else {%>
                <li class="dropdown">
                    <a aria-expanded="false" aria-haspopup="true"
                       class="dropdown-toggle"
                       data-toggle="dropdown"
                       href="#"
                       role="button">${loginUser} <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="signout">退出</a></li>
                    </ul>
                </li>
                <%}%>
            </ul>
        </div>
        <!--/.nav-collapse -->
    </div>
</nav>

<div class="container">
    <div class="form-inline">
        <div class="row">
            <div class="form-group">
                <label for="title">产品名称</label>
                <input type="text" class="form-control" id="title" placeholder="请输入产品名称" maxlength="20">
            </div>

            <div class="form-group">
                <label for="desc" class="control-label">产品描述</label>
                <input type="text" class="form-control" id="desc" placeholder="请输入产品描述" maxlength="32">
            </div>

            <div class="form-group">
                <label for="level" class="control-label">优先级</label>
                <input type="text" class="form-control match-rotation-input" maxlength="4"
                       onkeyup="value=value.replace(/[^\d]/g,'')"
                       onblur="value=value.replace(/[^\d]/g,'')" placeholder="数字越小，优先级越高。"
                       name="level"
                       id="level">
            </div>

            <div class="form-group">
                <label for="status" class="control-label">状态</label>
                <select name="status" id="status" class="form-control">
                    <option value="">请选择</option>
                    <option value="1">启用</option>
                    <option value="2">禁用</option>
                </select>
            </div>
        </div>

        <div class="row mt-10">
            <div class="form-group">
                <label for="region-select-box">所属区域</label>
                <div id="region-select-box" class="form-inline" style="display:inline-block"></div>
            </div>

            <button class="btn btn-default" id="queryBtn">查询</button>
        </div>
    </div>
    <div class="btn-group mt-10">
        <a class="btn btn-primary" href="prod/create">创建产品</a>
    </div>
    <table id="prodTable" class="mt-10"></table>
</div>
<!-- /container -->


<footer>
    <center>
        <p>Copyright © nongte.com (2020 - present) all right reserved</p>
    </center>
</footer>
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="js/ie10-viewport-bug-workaround.js"></script>

<!-- Latest compiled and minified CSS -->
<link href="https://unpkg.com/bootstrap-table@1.18.0/dist/bootstrap-table.min.css" rel="stylesheet">
<!-- Latest compiled and minified JavaScript -->
<script src="https://unpkg.com/bootstrap-table@1.18.0/dist/bootstrap-table.min.js"></script>
<!-- Latest compiled and minified Locales -->
<script src="https://unpkg.com/bootstrap-table@1.18.0/dist/locale/bootstrap-table-zh-CN.min.js"></script>

<script src="js/j-area-data.js"></script>
<script src="js/j-area-select.js"></script>
<script>
    $(function() {
        $("#queryBtn").click(function() {
            $("#prodTable").bootstrapTable('refresh');
        });

        $("#prodTable").bootstrapTable({
            url:"prod/list/query",   //请求地址
            striped : true, //是否显示行间隔色
            pageNumber : 1, //初始化加载第一页
            pagination : true, //是否分页
            sidePagination : 'server',//server:服务器端分页|client：前端分页
            pageSize : 5, //单页记录数
            pageList : [5, 10, 20, 30],//可选择单页记录数
            showRefresh : false,//刷新按钮
            queryParams : function(params) {//上传服务器的参数
                var areaObj = areaSelector.getAreaObj();
                var temp = {
                    offset :params.offset + 0,// SQL语句起始索引
                    pageNumber : params.limit  // 每页显示数量
                    , title: $("#title").val()
                    , desc: $("#desc").val()
                    , level: $("#level").val()
                    , province_code: areaObj.province_code
                    , city_code: areaObj.city_code
                    , area_code: areaObj.area_code
                    , status: $("#status").find('option:selected').val()
                };
                return temp;
            },
            columns : [
            {
                title : '编号',
                field : 'id',
                align: 'center'
            },
            {
                title : '产品名称',
                field : 'title',
                align: 'center'
            },
            {
                title : '描述',
                field : 'desc',
                align: "center",
                halign: "center",
                valign: 'middle'
            },
            {
                title : '所属区域',
                field : 'region',
                align: "center",
                halign: "center",
                valign: 'middle'
            },
             {
                title : '创建时间',
                field : 'create_time',
                align: "center",
                halign: "center",
                valign: 'middle'
            },
            {
                title : '状态',
                field : 'status',
                align: 'center',
                formatter: function(value, row, index) {
                    var result='';
                    if (row.status === 2) {
                        result += '<span class="label label-default">已禁用</span>'
                    } else {
                        result += '<span class="label label-success">已启用</span>'
                    }
                    return result;
                }
            },
            {
                title: '操作',
                field: 'opr',
                align: 'center',
                events: {
                    'click #enable': function(e, value, row, index) {
                        changeStatus(row.id, 1);
                    },
                    'click #disable': function(e, value, row, index) {
                        changeStatus(row.id, 2);
                    }
                },
                formatter: function(value, row, index) {
                    var result="";
                    result += "<a class='btn btn-success' href='prod/detail/"+row.id+"' style='margin-right: 10px;'>详情</a>";
                    result += "<a class='btn btn-warning' href='prod/edit/"+row.id+"' style='margin-right: 10px;'>修改</a>";
                    if (row.status === 2) {
                        result += "<a class='btn btn-primary' href='javascript:void(0)' id='enable'>启用</a>";
                    } else {
                        result += "<a class='btn btn-danger' href='javascript:void(0)' id='disable'>禁用</a>";
                    }
                    return result;
                }
            }
            ]
        })
    });

    function changeStatus(id, status) {
        $.ajax({
            url: 'prod/changeStatus',
            type: 'post',
            data: {id: id, status: status},
            success: function(result) {
                // 状态修改成功后刷新
                window.location.reload();
            },
            error: function(err) {
                alert(err);
            }
        });
    }

    function initAreaSelector() {
        var area = $('#region-select-box').JAreaSelect({
          prov: '',
        });
        return area;
    }

    var areaSelector = initAreaSelector();





</script>
<style>
    select {
        margin-right:3px;
    }

</style>
</body>
</html>
